var Tetryon=function(e){this._config=e,this._serverUrl=this._config.serverUrl?this._config.serverUrl:null,this._serverHttpPort=this._config.serverHttpPort?this._config.serverHttpPort:80,this._serverHttpsPort=this._config.serverHttpsPort?this._config.serverHttpsPort:443,null!==this._serverUrl&&("/"!==this._serverUrl.substr(this._serverUrl.length-1)&&(this._serverUrl+="/"),this._serverUrl.indexOf("://")>=0&&(this._serverUrl=this._serverUrl.substr(this._serverUrl.indexOf("://")+3)),this._serverUrl="https:"===document.location.protocol?"https://"+this._serverUrl.substr(0,this._serverUrl.indexOf("/"))+":"+this._serverHttpsPort+this._serverUrl.substr(this._serverUrl.indexOf("/")):"http://"+this._serverUrl.substr(0,this._serverUrl.indexOf("/"))+":"+this._serverHttpPort+this._serverUrl.substr(this._serverUrl.indexOf("/"))),this.__keyPrefix="_ttyn",this.__beamKey=this.__keyPrefix+"Beam",this.__identifierKey=this.__keyPrefix+"Identifier",this.__requestKey=this.__keyPrefix+"Request",this.__particleEndpoint="particle",this.__beamEndpoint="beam",this.__requestCharLimit=2e3};Tetryon.prototype._generateBeamId=function(){for(var e="abcdefghijklmnopqrstuvwxyz00123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",t="";t.length<52;)t+=e[Math.floor(Math.random()*e.length)];for(var i=Date.now().toString(36);i.length<12;)i="0"+i;return t+=i},Tetryon.prototype._generateRequestId=function(){for(var e="abcdefghijklmnopqrstuvwxyz00123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",t="";t.length<12;)t+=e[Math.floor(Math.random()*e.length)];for(var i=Date.now().toString(36);i.length<12;)i="0"+i;return t+=i},Tetryon.prototype._encodeRequestParam=function(e,t,i){return e+":"+t+"-"+i},Tetryon.prototype._mergeDataObjects=function(e,t){var n={};if(e&&"object"==typeof e)for(i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&"object"==typeof t)for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},Tetryon.prototype._getBeamId=function(){if(docCookies.hasItem(this.__beamKey))return docCookies.getItem(this.__beamKey);var e=this._generateBeamId();return docCookies.setItem(this.__beamKey,e,1/0)?e:!1},Tetryon.prototype._getIdentifier=function(){return docCookies.hasItem(this.__identifierKey)?docCookies.getItem(this.__identifierKey):this._getBeamId()},Tetryon.prototype._setIdentifier=function(e){return docCookies.setItem(this.__identifierKey,e,1/0)?this._getIdentifier():this._getBeamId()},Tetryon.prototype._getUtmData=function(){var e={},t=document.location.search;t=t.substring(1,t.length),queryParameters=t.split("&");for(i in queryParameters){var n=queryParameters[i].split("=");0==n[0].indexOf("utm_")&&(e[n[0]]=n[1])}return e},Tetryon.prototype._getDeviceData=function(){var e={};return e.device="unknown",device.mobile()?e.device="phone":device.tablet()?e.device="tablet":device.desktop()&&(e.device="desktop"),e},Tetryon.prototype._sendRequest=function(e,t,i){if("undefined"==typeof i&&(i=function(){}),null===this._serverUrl)throw"Missing serverUrl.";var n=this._serverUrl;if("particle"===e)n+=this.__particleEndpoint;else{if("beam"!==e)throw"Invalid request type: "+e;n+=this.__beamEndpoint}delete t[this.__beamKey],delete t[this.__requestKey],t[this.__beamKey]=this._getBeamId();var r=[],o=0;for(key in t){var s=key.toString().substr(0,255),d=t[key].toString().substr(0,255),c=encodeURIComponent(s).length+encodeURIComponent(d).length+2;r[o]&&r[o].length+c>this.__requestCharLimit&&o++,"undefined"==typeof r[o]?r[o]="?":r[o]+="&",r[o]+=encodeURIComponent(s),r[o]+="="+encodeURIComponent(d)}for(var a=this._generateRequestId(),u=0;u<r.length;u++){var h=this._encodeRequestParam(a,u+1,r.length);r[u]+="&"+encodeURIComponent(this.__requestKey)+"="+encodeURIComponent(h)}for(var v=[],u=0;u<r.length;u++)v[u]=new Image,v[u].onload=i,v[u].src=n+r[u];return!0},Tetryon.prototype.createVisitParticle=function(e,t){"undefined"==typeof t&&(t=function(){});var i=this._mergeDataObjects({},e);return i=this._mergeDataObjects(i,this._getDeviceData()),i=this._mergeDataObjects(i,this._getUtmData()),i.referrer=document.referrer,i[this.__keyPrefix+"Event"]="visit",i[this.__keyPrefix+"Domain"]=document.location.host,i[this.__keyPrefix+"Path"]=document.location.pathname,this._sendRequest("particle",i,t)},Tetryon.prototype.createParticle=function(e,t,i){"undefined"==typeof i&&(i=function(){});var n=this._mergeDataObjects({},t);return n[this.__keyPrefix+"Event"]="visit",n[this.__keyPrefix+"Domain"]=document.location.host,n[this.__keyPrefix+"Path"]=document.location.pathname,this._sendRequest("particle",n,i)},Tetryon.prototype.identifyBeam=function(e,t){if("undefined"==typeof t&&(t=function(){}),this._getIdentifier()==e)return t();var i={};return i[this.__identifierKey]=this._setIdentifier(e),this._sendRequest("beam",i,t)};var docCookies={getItem:function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(e,t,i,n,r,o){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(i)switch(i.constructor){case Number:s=1/0===i?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i;break;case String:s="; expires="+i;break;case Date:s="; expires="+i.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(r?"; domain="+r:"")+(n?"; path="+n:"")+(o?"; secure":""),!0},removeItem:function(e,t,i){return this.hasItem(e)?(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(t?"; path="+t:""),!0):!1},hasItem:function(e){return e?new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,i=0;t>i;i++)e[i]=decodeURIComponent(e[i]);return e}};(function(){var e,t,i,n,r,o,s,d,c,a;e=window.device,window.device={},i=window.document.documentElement,a=window.navigator.userAgent.toLowerCase(),device.ios=function(){return device.iphone()||device.ipod()||device.ipad()},device.iphone=function(){return n("iphone")},device.ipod=function(){return n("ipod")},device.ipad=function(){return n("ipad")},device.android=function(){return n("android")},device.androidPhone=function(){return device.android()&&n("mobile")},device.androidTablet=function(){return device.android()&&!n("mobile")},device.blackberry=function(){return n("blackberry")||n("bb10")||n("rim")},device.blackberryPhone=function(){return device.blackberry()&&!n("tablet")},device.blackberryTablet=function(){return device.blackberry()&&n("tablet")},device.windows=function(){return n("windows")},device.windowsPhone=function(){return device.windows()&&n("phone")},device.windowsTablet=function(){return device.windows()&&n("touch")&&!device.windowsPhone()},device.fxos=function(){return(n("(mobile;")||n("(tablet;"))&&n("; rv:")},device.fxosPhone=function(){return device.fxos()&&n("mobile")},device.fxosTablet=function(){return device.fxos()&&n("tablet")},device.meego=function(){return n("meego")},device.cordova=function(){return window.cordova&&"file:"===location.protocol},device.nodeWebkit=function(){return"object"==typeof window.process},device.mobile=function(){return device.androidPhone()||device.iphone()||device.ipod()||device.windowsPhone()||device.blackberryPhone()||device.fxosPhone()||device.meego()},device.tablet=function(){return device.ipad()||device.androidTablet()||device.blackberryTablet()||device.windowsTablet()||device.fxosTablet()},device.desktop=function(){return!device.tablet()&&!device.mobile()},device.portrait=function(){return window.innerHeight/window.innerWidth>1},device.landscape=function(){return window.innerHeight/window.innerWidth<1},device.noConflict=function(){return window.device=e,this},n=function(e){return-1!==a.indexOf(e)},o=function(e){var t;return t=new RegExp(e,"i"),i.className.match(t)},t=function(e){return o(e)?void 0:i.className+=" "+e},d=function(e){return o(e)?i.className=i.className.replace(e,""):void 0},device.ios()?device.ipad()?t("ios ipad tablet"):device.iphone()?t("ios iphone mobile"):device.ipod()&&t("ios ipod mobile"):t(device.android()?device.androidTablet()?"android tablet":"android mobile":device.blackberry()?device.blackberryTablet()?"blackberry tablet":"blackberry mobile":device.windows()?device.windowsTablet()?"windows tablet":device.windowsPhone()?"windows mobile":"desktop":device.fxos()?device.fxosTablet()?"fxos tablet":"fxos mobile":device.meego()?"meego mobile":device.nodeWebkit()?"node-webkit":"desktop"),device.cordova()&&t("cordova"),r=function(){return device.landscape()?(d("portrait"),t("landscape")):(d("landscape"),t("portrait"))},c="onorientationchange"in window,s=c?"orientationchange":"resize",window.addEventListener?window.addEventListener(s,r,!1):window.attachEvent?window.attachEvent(s,r):window[s]=r,r()}).call(this);